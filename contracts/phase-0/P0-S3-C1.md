# Contract P0-S3-C1: Shape Drawing System

## Metadata
- **Contract ID**: P0-S3-C1
- **System**: Basic Rendering
- **Priority**: High
- **Estimated Time**: 30 minutes
- **Dependencies**: P0-S1-C1
- **Version**: 1.0.0

## Description
Implement a shape drawing system that can render basic geometric shapes (rectangles, circles, lines) with specified colors. This forms the foundation for all programmatic graphics in the game.

## UTF Test Blocks

### UTF-Block-P0-S3-C1-T1: Rectangle Drawing
```python
# Test: Rectangles draw correctly
def test_rectangle_drawing():
    """
    Given: A surface to draw on
    When: draw_rect(x=100, y=100, w=50, h=30, color=RED)
    Then:
      - Rectangle appears at (100, 100)
      - Size is exactly 50x30 pixels
      - Color is (255, 0, 0)
      - Edges are pixel-perfect
      - Filled by default
    """
    # Error-Tags: ['INVALID_RECT_PARAMS', 'DRAW_FAILED']
```

### UTF-Block-P0-S3-C1-T2: Circle Drawing
```python
# Test: Circles draw correctly
def test_circle_drawing():
    """
    Given: A surface to draw on
    When: draw_circle(x=200, y=200, radius=25, color=BLUE)
    Then:
      - Circle centered at (200, 200)
      - Radius is exactly 25 pixels
      - Color is (0, 0, 255)
      - Circle is antialiased
      - Filled by default
    """
    # Error-Tags: ['INVALID_CIRCLE_PARAMS', 'RADIUS_NEGATIVE']
```

### UTF-Block-P0-S3-C1-T3: Line Drawing
```python
# Test: Lines draw correctly
def test_line_drawing():
    """
    Given: A surface to draw on
    When: draw_line(x1=0, y1=0, x2=100, y2=100, color=GREEN, width=3)
    Then:
      - Line from (0, 0) to (100, 100)
      - Color is (0, 255, 0)
      - Width is 3 pixels
      - Line is antialiased
      - Diagonal lines are smooth
    """
    # Error-Tags: ['INVALID_LINE_PARAMS', 'WIDTH_INVALID']
```

### UTF-Block-P0-S3-C1-T4: Outline Drawing
```python
# Test: Shape outlines draw correctly
def test_outline_drawing():
    """
    Given: A surface to draw on
    When: draw_rect(x=50, y=50, w=100, h=100, color=WHITE, filled=False, width=2)
    Then:
      - Only outline is drawn
      - Outline width is 2 pixels
      - Interior is transparent
      - Corners are properly joined
      - Works for rect and circle
    """
    # Error-Tags: ['OUTLINE_WIDTH_INVALID', 'FILL_MODE_ERROR']
```

## Implementation Requirements

### Core Components
```python
# renderer.py
class Renderer:
    def __init__(self, surface: pygame.Surface):
        """Initialize renderer with target surface."""
        
    def draw_rect(self, x: int, y: int, width: int, height: int, 
                  color: Tuple[int, int, int], filled: bool = True,
                  border_width: int = 1) -> None:
        """Draw a rectangle."""
        
    def draw_circle(self, x: int, y: int, radius: int,
                    color: Tuple[int, int, int], filled: bool = True,
                    border_width: int = 1) -> None:
        """Draw a circle."""
        
    def draw_line(self, x1: int, y1: int, x2: int, y2: int,
                  color: Tuple[int, int, int], width: int = 1) -> None:
        """Draw a line."""
        
    def clear(self, color: Tuple[int, int, int] = BLACK) -> None:
        """Clear surface with color."""

# colors.py
# Standard color constants
BLACK = (0, 0, 0)
WHITE = (255, 255, 255)
RED = (255, 0, 0)
GREEN = (0, 255, 0)
BLUE = (0, 0, 255)
GRAY = (128, 128, 128)
```

### Error Tags
- `INVALID_RECT_PARAMS`: Rectangle parameters invalid
- `DRAW_FAILED`: Drawing operation failed
- `INVALID_CIRCLE_PARAMS`: Circle parameters invalid
- `RADIUS_NEGATIVE`: Circle radius is negative
- `INVALID_LINE_PARAMS`: Line parameters invalid
- `WIDTH_INVALID`: Line/border width invalid
- `OUTLINE_WIDTH_INVALID`: Outline width out of range
- `FILL_MODE_ERROR`: Fill/outline mode conflict
- `COLOR_OUT_OF_RANGE`: Color values not in 0-255

## DDERF Strategies

### INVALID_RECT_PARAMS
1. **Detect**: Width or height <= 0, position out of bounds
2. **Diagnose**: Check parameter validation
3. **Explain**: "Invalid rectangle dimensions"
4. **Resolve**: Skip draw, log warning
5. **Fix**: Clamp values to valid range

### COLOR_OUT_OF_RANGE
1. **Detect**: Color component < 0 or > 255
2. **Diagnose**: Check color validation
3. **Explain**: "Color values must be 0-255"
4. **Resolve**: Clamp to valid range
5. **Fix**: Add color validation utility

## Security Considerations
- Validate all numeric parameters
- Prevent integer overflow in calculations
- Bounds check against surface dimensions

## Acceptance Criteria
- [ ] All basic shapes draw correctly
- [ ] Colors render accurately
- [ ] Filled and outline modes work
- [ ] Antialiasing enabled where appropriate
- [ ] No drawing outside surface bounds
- [ ] All UTF tests pass
- [ ] Coverage â‰¥95%